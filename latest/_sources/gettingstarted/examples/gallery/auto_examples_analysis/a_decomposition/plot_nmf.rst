
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: default

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: default

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: default

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: default

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: default

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: default

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: default

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.1401742102450191
    violation: 0.06158195065493218
    violation: 0.03477774452872489
    violation: 0.023155912689776684
    violation: 0.016289564836607217
    violation: 0.011732197722809546
    violation: 0.009261179153189945
    violation: 0.007770502529914299
    violation: 0.006957471610158965
    violation: 0.006457414370354955
    violation: 0.006191115125282206
    violation: 0.006057238974457554
    violation: 0.006000777806339217
    violation: 0.005868357891308917
    violation: 0.005802918028533962
    violation: 0.005772367658829896
    violation: 0.005756947971777759
    violation: 0.005733332889918786
    violation: 0.00570060662464485
    violation: 0.005667827078790863
    violation: 0.005587736630048262
    violation: 0.005529135183167055
    violation: 0.005460760674075929
    violation: 0.005375194673451642
    violation: 0.005288054442075087
    violation: 0.005203284939611658
    violation: 0.005110269931845248
    violation: 0.005004969613317492
    violation: 0.00488940194456726
    violation: 0.004778610916794704
    violation: 0.004657040705272491
    violation: 0.004527642308383202
    violation: 0.004393717477174973
    violation: 0.00426712413892572
    violation: 0.004133928133016256
    violation: 0.004012755928138946
    violation: 0.0038914653519269457
    violation: 0.003765260270042579
    violation: 0.0036375148218627273
    violation: 0.0035147101661544057
    violation: 0.0033965138303584694
    violation: 0.003292520557980629
    violation: 0.003194164813272159
    violation: 0.0031049470293332726
    violation: 0.003022167403550115
    violation: 0.0029389646390338203
    violation: 0.0028561158500456396
    violation: 0.0027738912186805165
    violation: 0.0026927116687366515
    violation: 0.0026129548289080718
    violation: 0.002535164470212031
    violation: 0.0024587403634380393
    violation: 0.002384202690791067
    violation: 0.0023133039094785147
    violation: 0.0022437367434811825
    violation: 0.0021751169925787648
    violation: 0.0021084094490922394
    violation: 0.002043667805247986
    violation: 0.00198066435935071
    violation: 0.0019243270194359658
    violation: 0.0018713261632060615
    violation: 0.0018195678200696357
    violation: 0.0017692749012864109
    violation: 0.0017204657491194531
    violation: 0.0016731692686995584
    violation: 0.0016274950351470798
    violation: 0.001583917332969971
    violation: 0.0015418960309272894
    violation: 0.0015014385431316583
    violation: 0.0014629272012162018
    violation: 0.0014262081321620007
    violation: 0.0013907597658089066
    violation: 0.0013601582805158545
    violation: 0.0013328464824003622
    violation: 0.0013065923988235253
    violation: 0.0012813357494812969
    violation: 0.0012569657401119265
    violation: 0.0012363658727397892
    violation: 0.0012190114699552927
    violation: 0.001199211654450114
    violation: 0.0011775622624510982
    violation: 0.0011582609085414646
    violation: 0.0011389415923629997
    violation: 0.0011199124929360195
    violation: 0.0011006754884538715
    violation: 0.0010832777040277078
    violation: 0.0010661363692304093
    violation: 0.0010491933694700677
    violation: 0.0010318244102608034
    violation: 0.0010150792321235666
    violation: 0.0009988201809297422
    violation: 0.0009841318528820801
    violation: 0.0009699922960877982
    violation: 0.0009545966012009882
    violation: 0.0009396363331385069
    violation: 0.0009266599168145319
    violation: 0.0009140262172600605
    violation: 0.0009015875006379814
    violation: 0.0008902182357107357
    violation: 0.0008780499311871394
    violation: 0.000866045747092104
    violation: 0.000854351749993768
    violation: 0.0008428706003287414
    violation: 0.0008315536804370643
    violation: 0.0008208847158801197
    violation: 0.0008104269807765015
    violation: 0.0007997522484737917
    violation: 0.0007893350738952302
    violation: 0.0007791326607912716
    violation: 0.0007691414390017999
    violation: 0.0007597179067853346
    violation: 0.0007504652538891694
    violation: 0.0007412456856970325
    violation: 0.0007322966170541309
    violation: 0.0007235915691685871
    violation: 0.0007151920055396528
    violation: 0.0007069372346704195
    violation: 0.0006987637535248629
    violation: 0.0006907733550824707
    violation: 0.0006830298779800046
    violation: 0.0006754181243925217
    violation: 0.0006679795936493212
    violation: 0.0006606893398231086
    violation: 0.0006536091296353492
    violation: 0.000646664112099606
    violation: 0.0006399762615474557
    violation: 0.0006335488650773158
    violation: 0.00062739574206898
    violation: 0.0006215236000711586
    violation: 0.0006161518203755112
    violation: 0.00061139181517719
    violation: 0.0006071251736135608
    violation: 0.0006030938520875693
    violation: 0.0005992255771887853
    violation: 0.0005955122189370821
    violation: 0.0005919356405965501
    violation: 0.0005884735105283392
    violation: 0.0005851626197889966
    violation: 0.000581947296680379
    violation: 0.0005788624242481703
    violation: 0.0005759087479599108
    violation: 0.0005730546137308492
    violation: 0.0005702968600984047
    violation: 0.0005676053787182383
    violation: 0.0005650176785171903
    violation: 0.0005624480584370869
    violation: 0.0005599281471045278
    violation: 0.0005574208102720327
    violation: 0.0005549930907515082
    violation: 0.000552626309068821
    violation: 0.0005503237863512918
    violation: 0.0005480875748007522
    violation: 0.0005458976082895573
    violation: 0.0005437570853969024
    violation: 0.0005416726314725858
    violation: 0.0005396329582221622
    violation: 0.0005376381718607872
    violation: 0.0005358628850810348
    violation: 0.0005342566446344482
    violation: 0.0005327134944354552
    violation: 0.0005311700256182937
    violation: 0.0005296374901746783
    violation: 0.0005281469649348852
    violation: 0.0005266549474161374
    violation: 0.0005251860718895286
    violation: 0.0005237318107588685
    violation: 0.0005222955570665267
    violation: 0.0005208942964236014
    violation: 0.0005195265168846245
    violation: 0.0005181813428115394
    violation: 0.0005168846752739201
    violation: 0.0005156608680272551
    violation: 0.0005144616554311701
    violation: 0.0005132891688190244
    violation: 0.0005121515266402717
    violation: 0.0005110364330892512
    violation: 0.0005099447315062611
    violation: 0.0005088753613792431
    violation: 0.0005078236610580104
    violation: 0.000506790911202552
    violation: 0.0005057740763561747
    violation: 0.0005047767175615145
    violation: 0.0005037958933649346
    violation: 0.0005028222129277746
    violation: 0.000501865042847939
    violation: 0.0005009224423798851
    violation: 0.000499997496249011
    violation: 0.0004990872395199374
    violation: 0.0004981962000745905
    violation: 0.000497314731819117
    violation: 0.0004964417296738674
    violation: 0.0004955753197881919
    violation: 0.0004946901218459501
    violation: 0.0004938210437307363
    violation: 0.0004929673596845469
    violation: 0.000492122635584666
    violation: 0.0004912871202793985
    violation: 0.000490459652853722
    violation: 0.0004896376456529767
    /home/runner/micromamba/envs/scpy_docs/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.2781188101128518
    violation: 0.21103839273442004
    violation: 0.16365897573754964
    violation: 0.126381245028573
    violation: 0.09689398092858015
    violation: 0.07386553913526468
    violation: 0.0572630488363916
    violation: 0.04639710696895116
    violation: 0.037762701010724486
    violation: 0.030324671559648575
    violation: 0.024000077998569933
    violation: 0.01870505431885565
    violation: 0.014282427091628205
    violation: 0.010676123451468863
    violation: 0.008016534827385886
    violation: 0.006238616114828345
    violation: 0.005124394633030189
    violation: 0.00449075747965651
    violation: 0.004053115751123395
    violation: 0.003744302603668883
    violation: 0.0034289628116608902
    violation: 0.0030323190347559792
    violation: 0.002727253739146781
    violation: 0.0023865056940470582
    violation: 0.0020851628627841343
    violation: 0.0017697484695162503
    violation: 0.0014925716272857702
    violation: 0.0012488601974044973
    violation: 0.001043867511137783
    violation: 0.0008573236692762054
    violation: 0.0006991377766200632
    violation: 0.0005706218431926792
    violation: 0.0004636286240955681
    violation: 0.0003748723547990084
    violation: 0.00030325790844273377
    violation: 0.0002463663859384112
    violation: 0.0001982580479040741
    violation: 0.00015827733519298818
    violation: 0.0001243907579281734
    violation: 9.611089606617745e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: default

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: default

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: default


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.945 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
