
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/plot_nmf.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:


NMF analysis example
====================

.. GENERATED FROM PYTHON SOURCE LINES 15-16

Import the spectrochempy API package

.. GENERATED FROM PYTHON SOURCE LINES 16-18

.. code-block:: default

    import spectrochempy as scp








.. GENERATED FROM PYTHON SOURCE LINES 19-21

Prepare the dataset to NMF factorize
-------------------------------------

.. GENERATED FROM PYTHON SOURCE LINES 23-25

Here we use a FTIR dataset corresponding the dehydration of a NH4Y zeolite
and recorded in the OMNIC format.

.. GENERATED FROM PYTHON SOURCE LINES 25-27

.. code-block:: default

    dataset = scp.read_omnic("irdata/nh4y-activation.spg")








.. GENERATED FROM PYTHON SOURCE LINES 28-31

Mask some columns (features) wich correspond to saturated part of the spectra.
Note taht we use float number for defining the limits for masking as coordinates
(integer numbers would mean point index and s would lead t incorrect results)

.. GENERATED FROM PYTHON SOURCE LINES 31-33

.. code-block:: default

    dataset[:, 882.0:1280.0] = scp.MASKED








.. GENERATED FROM PYTHON SOURCE LINES 34-37

Make sure all data are positive. For this we use the math fonctionalities of NDDataset
objects (:meth:`min` function to find the minimum value of the dataset
and the `-` operator for subtrating this value to all spectra of the dataset.

.. GENERATED FROM PYTHON SOURCE LINES 37-39

.. code-block:: default

    dataset -= dataset.min()








.. GENERATED FROM PYTHON SOURCE LINES 40-41

Plot it for a visual check

.. GENERATED FROM PYTHON SOURCE LINES 41-43

.. code-block:: default

    _ = dataset.plot()




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :alt: plot nmf
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_001.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 44-49

Create a NMF object
-------------------

As argument of the object constructor we define log_level to ``"INFO"`` to
obtain verbose output during fit, and we set the number of component to use at 4.

.. GENERATED FROM PYTHON SOURCE LINES 49-51

.. code-block:: default

    model = scp.NMF(n_components=4, log_level="INFO")








.. GENERATED FROM PYTHON SOURCE LINES 52-54

Fit the model
-------------

.. GENERATED FROM PYTHON SOURCE LINES 54-65

.. code-block:: default

    _ = model.fit(dataset)

    # Get the results
    # ---------------
    #
    # The concentration :math:`C` and the transposed matrix of spectra :math:`S^T` can
    # be obtained as follow
    C = model.transform()
    St = model.components






.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    violation: 1.0
    violation: 0.1401742102450199
    violation: 0.061581950654932514
    violation: 0.034777744528725084
    violation: 0.023155912689776723
    violation: 0.016289564836607436
    violation: 0.011732197722809888
    violation: 0.009261179153190054
    violation: 0.007770502529914349
    violation: 0.0069574716101590646
    violation: 0.006457414370355135
    violation: 0.006191115125282208
    violation: 0.006057238974457735
    violation: 0.006000777806339478
    violation: 0.005868357891308834
    violation: 0.0058029180285340464
    violation: 0.005772367658829949
    violation: 0.005756947971778096
    violation: 0.005733332889918748
    violation: 0.005700606624644992
    violation: 0.00566782707879073
    violation: 0.00558773663004833
    violation: 0.005529135183166916
    violation: 0.005460760674076043
    violation: 0.0053751946734516285
    violation: 0.005288054442075052
    violation: 0.0052032849396117875
    violation: 0.005110269931845336
    violation: 0.005004969613317427
    violation: 0.004889401944567228
    violation: 0.004778610916794583
    violation: 0.0046570407052726505
    violation: 0.004527642308383015
    violation: 0.004393717477175119
    violation: 0.004267124138925848
    violation: 0.004133928133016144
    violation: 0.00401275592813857
    violation: 0.0038914653519267718
    violation: 0.003765260270042699
    violation: 0.0036375148218628496
    violation: 0.003514710166154315
    violation: 0.0033965138303582105
    violation: 0.003292520557980566
    violation: 0.0031941648132723624
    violation: 0.0031049470293334955
    violation: 0.003022167403549971
    violation: 0.0029389646390339795
    violation: 0.0028561158500456036
    violation: 0.002773891218680215
    violation: 0.002692711668736727
    violation: 0.0026129548289076333
    violation: 0.0025351644702122414
    violation: 0.0024587403634381507
    violation: 0.002384202690790864
    violation: 0.0023133039094785325
    violation: 0.002243736743481127
    violation: 0.002175116992578676
    violation: 0.002108409449092348
    violation: 0.0020436678052479433
    violation: 0.00198066435935069
    violation: 0.0019243270194359732
    violation: 0.0018713261632059234
    violation: 0.0018195678200697597
    violation: 0.0017692749012865648
    violation: 0.0017204657491193963
    violation: 0.0016731692686994997
    violation: 0.0016274950351469735
    violation: 0.0015839173329701397
    violation: 0.0015418960309272745
    violation: 0.0015014385431314206
    violation: 0.0014629272012161624
    violation: 0.0014262081321619927
    violation: 0.0013907597658086635
    violation: 0.00136015828051556
    violation: 0.0013328464824003963
    violation: 0.0013065923988234754
    violation: 0.0012813357494809684
    violation: 0.0012569657401118976
    violation: 0.0012363658727400188
    violation: 0.0012190114699549592
    violation: 0.0011992116544500672
    violation: 0.0011775622624513576
    violation: 0.0011582609085415412
    violation: 0.001138941592363129
    violation: 0.0011199124929360002
    violation: 0.0011006754884539084
    violation: 0.0010832777040275844
    violation: 0.0010661363692305915
    violation: 0.0010491933694700914
    violation: 0.0010318244102606247
    violation: 0.001015079232123731
    violation: 0.0009988201809299716
    violation: 0.000984131852881554
    violation: 0.0009699922960878538
    violation: 0.0009545966012007717
    violation: 0.0009396363331386547
    violation: 0.0009266599168147038
    violation: 0.0009140262172601162
    violation: 0.0009015875006376682
    violation: 0.0008902182357106369
    violation: 0.0008780499311870917
    violation: 0.0008660457470918032
    violation: 0.0008543517499940897
    violation: 0.0008428706003287421
    violation: 0.0008315536804369419
    violation: 0.0008208847158803081
    violation: 0.0008104269807767117
    violation: 0.0007997522484737408
    violation: 0.0007893350738953619
    violation: 0.0007791326607911835
    violation: 0.0007691414390018504
    violation: 0.0007597179067852333
    violation: 0.0007504652538891322
    violation: 0.0007412456856972835
    violation: 0.0007322966170541211
    violation: 0.0007235915691683499
    violation: 0.0007151920055396879
    violation: 0.000706937234670679
    violation: 0.0006987637535246032
    violation: 0.000690773355082525
    violation: 0.0006830298779796282
    violation: 0.0006754181243926979
    violation: 0.0006679795936493203
    violation: 0.0006606893398231256
    violation: 0.0006536091296354006
    violation: 0.0006466641120996156
    violation: 0.0006399762615476633
    violation: 0.0006335488650774188
    violation: 0.0006273957420690376
    violation: 0.0006215236000709936
    violation: 0.0006161518203753982
    violation: 0.0006113918151773852
    violation: 0.000607125173613575
    violation: 0.0006030938520871335
    violation: 0.0005992255771888164
    violation: 0.0005955122189364697
    violation: 0.0005919356405964123
    violation: 0.0005884735105284958
    violation: 0.0005851626197891235
    violation: 0.0005819472966805782
    violation: 0.000578862424247964
    violation: 0.0005759087479596206
    violation: 0.0005730546137310442
    violation: 0.0005702968600984395
    violation: 0.0005676053787180791
    violation: 0.0005650176785169995
    violation: 0.0005624480584370052
    violation: 0.0005599281471048198
    violation: 0.0005574208102720457
    violation: 0.0005549930907513576
    violation: 0.0005526263090685777
    violation: 0.0005503237863511149
    violation: 0.0005480875748005515
    violation: 0.0005458976082893378
    violation: 0.0005437570853967655
    violation: 0.0005416726314725946
    violation: 0.0005396329582220997
    violation: 0.0005376381718606684
    violation: 0.0005358628850809115
    violation: 0.0005342566446345554
    violation: 0.0005327134944355132
    violation: 0.0005311700256181063
    violation: 0.0005296374901748313
    violation: 0.0005281469649347887
    violation: 0.0005266549474162405
    violation: 0.0005251860718896782
    violation: 0.00052373181075899
    violation: 0.0005222955570665673
    violation: 0.000520894296423657
    violation: 0.0005195265168843932
    violation: 0.0005181813428112166
    violation: 0.0005168846752733906
    violation: 0.0005156608680273287
    violation: 0.000514461655431189
    violation: 0.000513289168818964
    violation: 0.0005121515266403456
    violation: 0.0005110364330893185
    violation: 0.0005099447315066568
    violation: 0.0005088753613791636
    violation: 0.0005078236610581206
    violation: 0.0005067909112022476
    violation: 0.0005057740763560798
    violation: 0.0005047767175618103
    violation: 0.0005037958933651258
    violation: 0.000502822212927883
    violation: 0.0005018650428480075
    violation: 0.0005009224423798815
    violation: 0.0004999974962486374
    violation: 0.0004990872395198747
    violation: 0.0004981962000748816
    violation: 0.0004973147318189865
    violation: 0.0004964417296741658
    violation: 0.0004955753197880319
    violation: 0.0004946901218459474
    violation: 0.0004938210437306015
    violation: 0.000492967359684416
    violation: 0.0004921226355846847
    violation: 0.0004912871202794397
    violation: 0.0004904596528539912
    violation: 0.0004896376456529823
    /home/runner/micromamba/envs/scpy_docs/lib/python3.10/site-packages/sklearn/decomposition/_nmf.py:1742: ConvergenceWarning: Maximum number of iterations 200 reached. Increase it to improve convergence.
      warnings.warn(
    violation: 1.0
    violation: 0.2781188101128497
    violation: 0.21103839273441855
    violation: 0.1636589757375486
    violation: 0.12638124502857237
    violation: 0.0968939809285798
    violation: 0.0738655391352645
    violation: 0.05726304883639149
    violation: 0.0463971069689511
    violation: 0.03776270101072441
    violation: 0.030324671559648516
    violation: 0.024000077998569878
    violation: 0.018705054318855687
    violation: 0.014282427091628228
    violation: 0.010676123451468754
    violation: 0.00801653482738586
    violation: 0.0062386161148283445
    violation: 0.0051243946330300945
    violation: 0.004490757479656429
    violation: 0.004053115751123273
    violation: 0.0037443026036687484
    violation: 0.00342896281166083
    violation: 0.0030323190347558656
    violation: 0.0027272537391467145
    violation: 0.0023865056940469576
    violation: 0.002085162862783993
    violation: 0.0017697484695161963
    violation: 0.0014925716272857002
    violation: 0.0012488601974045028
    violation: 0.0010438675111377345
    violation: 0.0008573236692761941
    violation: 0.0006991377766200503
    violation: 0.0005706218431926856
    violation: 0.00046362862409555394
    violation: 0.0003748723547990223
    violation: 0.0003032579084427185
    violation: 0.0002463663859384379
    violation: 0.00019825804790408826
    violation: 0.00015827733519295162
    violation: 0.00012439075792817274
    violation: 9.61108960661813e-05
    Converged at iteration 42




.. GENERATED FROM PYTHON SOURCE LINES 66-68

Plot results
------------

.. GENERATED FROM PYTHON SOURCE LINES 68-70

.. code-block:: default

    _ = C.T.plot(title="Concentration", colormap=None, legend=C.k.labels)




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :alt: Concentration
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_002.png
   :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 72-78

.. code-block:: default

    m = St.ptp()
    for i in range(St.shape[0]):
        St.data[i] -= i * m / 2
    ax = St.plot(title="Components", colormap=None, legend=St.k.labels)
    ax.set_yticks([])




.. image-sg:: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :alt: Components
   :srcset: /gettingstarted/examples/gallery/auto_examples_analysis/a_decomposition/images/sphx_glr_plot_nmf_003.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    []



.. GENERATED FROM PYTHON SOURCE LINES 79-81

This ends the example ! The following line can be uncommented if no plot shows when
running the .py script with python

.. GENERATED FROM PYTHON SOURCE LINES 81-83

.. code-block:: default


    # scp.show()








.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  0.955 seconds)


.. _sphx_glr_download_gettingstarted_examples_gallery_auto_examples_analysis_a_decomposition_plot_nmf.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_nmf.py <plot_nmf.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_nmf.ipynb <plot_nmf.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
