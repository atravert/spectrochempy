
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "gettingstarted/gallery/auto_examples/analysis/plot_efa_keller_massart.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_gettingstarted_gallery_auto_examples_analysis_plot_efa_keller_massart.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_gettingstarted_gallery_auto_examples_analysis_plot_efa_keller_massart.py:


EFA analysis (Keller and Massart original example)
===================================================

In this example, we perform the Evolving Factor Analysis of a TEST dataset
(ref. Keller and Massart, Chemometrics and Intelligent Laboratory Systems,
12 (1992) 209-224 )

.. GENERATED FROM PYTHON SOURCE LINES 18-23

.. code-block:: default

    import numpy as np
    import spectrochempy as scp

    # sphinx_gallery_thumbnail_number = 5








.. GENERATED FROM PYTHON SOURCE LINES 24-28

Generate a test dataset
-----------------------
1) simulated chromatogram
*************************

.. GENERATED FROM PYTHON SOURCE LINES 28-38

.. code-block:: default


    t = scp.Coord(np.arange(15), units="minutes", title="time")  # time coordinates
    c = scp.Coord(range(2), title="components")  # component coordinates

    data = np.zeros((2, 15), dtype=np.float64)
    data[0, 3:8] = [1, 3, 6, 3, 1]  # compound 1
    data[1, 5:11] = [1, 3, 5, 3, 1, 0.5]  # compound 2

    dsc = scp.NDDataset(data=data, coords=[c, t])








.. GENERATED FROM PYTHON SOURCE LINES 39-41

2) absorption spectra
**********************

.. GENERATED FROM PYTHON SOURCE LINES 41-47

.. code-block:: default


    spec = np.array([[2.0, 3.0, 4.0, 2.0], [3.0, 4.0, 2.0, 1.0]])
    w = scp.Coord(np.arange(1, 5, 1), units="nm", title="wavelength")

    dss = scp.NDDataset(data=spec, coords=[c, w])








.. GENERATED FROM PYTHON SOURCE LINES 48-50

3) simulated data matrix
************************

.. GENERATED FROM PYTHON SOURCE LINES 50-57

.. code-block:: default


    dataset = scp.dot(dsc.T, dss)
    dataset.data = np.random.normal(dataset.data, 0.2)
    dataset.title = "intensity"

    dataset.plot()




.. image-sg:: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_001.png
   :alt: plot efa keller massart
   :srcset: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_001.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <_Axes: xlabel='values $\\mathrm{}$', ylabel='intensity $\\mathrm{}$'>



.. GENERATED FROM PYTHON SOURCE LINES 58-60

4) evolving factor analysis (EFA)
*********************************

.. GENERATED FROM PYTHON SOURCE LINES 60-63

.. code-block:: default


    efa = scp.EFA(dataset)








.. GENERATED FROM PYTHON SOURCE LINES 64-66

Plots of the log(EV) for the forward and backward analysis


.. GENERATED FROM PYTHON SOURCE LINES 66-71

.. code-block:: default


    efa.f_ev.T.plot(yscale="log", legend=efa.f_ev.y.labels)

    efa.b_ev.T.plot(yscale="log")




.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_002.png
         :alt: plot efa keller massart
         :srcset: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_003.png
         :alt: plot efa keller massart
         :srcset: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_003.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <_Axes: xlabel='values $\\mathrm{}$', ylabel='EigenValues $\\mathrm{}$'>



.. GENERATED FROM PYTHON SOURCE LINES 72-77

Looking at these EFA curves, it is quite obvious that only two components
are really significant, and this corresponds to the data that we have in
input.
We can consider that the third EFA components is mainly due to the noise,
and so we can use it to set a cut of values

.. GENERATED FROM PYTHON SOURCE LINES 77-84

.. code-block:: default


    n_pc = 2
    efa.cutoff = np.max(efa.f_ev[:, n_pc].data)

    f2 = efa.f_ev
    b2 = efa.b_ev








.. GENERATED FROM PYTHON SOURCE LINES 85-86

we concatenate the datasets to plot them in a single figure

.. GENERATED FROM PYTHON SOURCE LINES 86-91

.. code-block:: default

    both = scp.concatenate(f2, b2)
    both.T.plot(yscale="log")

    # TODO: add "legend" keyword in NDDataset.plot()




.. image-sg:: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_004.png
   :alt: plot efa keller massart
   :srcset: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_004.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <_Axes: xlabel='values $\\mathrm{}$', ylabel='EigenValues $\\mathrm{}$'>



.. GENERATED FROM PYTHON SOURCE LINES 92-94

Get the abstract concentration profile based on the FIFO EFA analysis


.. GENERATED FROM PYTHON SOURCE LINES 94-99

.. code-block:: default

    efa.cutoff = None
    c = efa.get_conc(n_pc)
    c.T.plot()

    # scp.show()  # uncomment to show plot if needed (not necessary in jupyter notebook)



.. image-sg:: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_005.png
   :alt: plot efa keller massart
   :srcset: /gettingstarted/gallery/auto_examples/analysis/images/sphx_glr_plot_efa_keller_massart_005.png
   :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none


    <_Axes: xlabel='values $\\mathrm{}$', ylabel='relative concentration $\\mathrm{}$'>




.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  2.049 seconds)


.. _sphx_glr_download_gettingstarted_gallery_auto_examples_analysis_plot_efa_keller_massart.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example




    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_efa_keller_massart.py <plot_efa_keller_massart.py>`

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_efa_keller_massart.ipynb <plot_efa_keller_massart.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
